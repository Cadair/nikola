## -*- coding: utf-8 -*-
<!-- Core CSS file -->
<link rel="stylesheet" href="/assets/css/photoswipe.css"> 

<!-- Skin CSS file (styling of UI - buttons, caption, etc.)
     In the folder of skin CSS file there are also:
     - .png and .svg icons sprite, 
     - preloader.gif (for browsers that do not support CSS animations) -->
<link rel="stylesheet" href="/assets/css/default-skin.css"> 

<!-- Core JS file -->
<script src="/assets/js/photoswipe.min.js"></script> 

<!-- UI JS file -->
<script src="/assets/js/photoswipe-ui-default.min.js"></script> 

<%block name="content">
<div id="${carousel_id}" class="carousel slide">
    <ol class="carousel-indicators">
    % for i in range(len(slides_content)):
        % if i == 0:
            <li data-target="#${carousel_id}" data-slide-to="${i}" class="active"></li>
        % else:
            <li data-target="#${carousel_id}" data-slide-to="${i}"></li>
        % endif
    % endfor
    </ol>
    <div class="carousel-inner">
        % for i, image in enumerate(slides_content):
            % if i == 0:
                <div class="item active"><img src="${image}" alt="" style="margin: 0 auto 0 auto;"></div>
            % else:
                <div class="item"><img src="${image}" alt="" style="margin: 0 auto 0 auto;"></div>
            % endif
        % endfor
    </div>
    <a class="left carousel-control" href="#${carousel_id}" data-slide="prev"><span class="icon-prev"></span></a>
    <a class="right carousel-control" href="#${carousel_id}" data-slide="next"><span class="icon-next"></span></a>
</div>
</%block>





<%inherit file="base.tmpl"/>
<%namespace name="comments" file="comments_helper.tmpl"/>
<%namespace name="ui" file="crumbs.tmpl" import="bar"/>
<%block name="sourcelink"></%block>

<%block name="content">
    ${ui.bar(crumbs)}
    %if title:
    <h1>${title|h}</h1>
    %endif
    %if post:
    <p>
        ${post.text()}
    </p>
    %endif
    %if folders:
    % if galleries_use_thumbnail:
    % for folder, ftitle, fpost in folders:
	% if loop.index % galleries_columns == 0:
	<div class="row">
	% endif
	  <div class="col-sm-6 col-md-4">
	    <div class="thumbnail">
	      <a href="${folder}">
		% if fpost and getattr(fpost, 'previewimage', None):
		<img src="${folder}${fpost.previewimage}" alt="${ftitle}">
		% elif galleries_default_thumbnail:
		<img src="${galleries_default_thumbnail}" alt="${ftitle}">
		% else:
		<div style="height: 250px; background-color: #eee;"></div>
		% endif
	      </a>
	      <div class="caption">
		<h3>${ftitle}</h3>
		% if fpost and fpost.description():
		<p>${fpost.description()}</p>
		% endif
	      </div>
	    </div>
	  </div>
	% if loop.index % galleries_columns == (galleries_columns - 1):
	</div>
	% endif
    % endfor

    % else:
        <ul>
            % for folder, ftitle in folders:
                <li><a href="${folder}"><i class="glyphicon glyphicon-folder-open"></i>&nbsp;${ftitle}</a></li>
            % endfor
        </ul>
    % endif
    %endif

<div id="gallery_container"></div>
%if photo_array:
<noscript>
<ul class="thumbnails">
    %for image in photo_array:
        <li><a href="${image['url']}" class="thumbnail image-reference" title="${image['title']}">
            <img src="${image['url_thumb']}" alt="${image['title']}" /></a>
    %endfor
</ul>
</noscript>
%endif
%if site_has_comments and enable_comments:
${comments.comment_form(None, permalink, title)}
%endif
</%block>

<%block name="extra_head">
${parent.extra_head()}
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<style type="text/css">
    .image-block {
        display: inline-block;
    }
    .flowr_row {
        width: 100%;
    }
    </style>
</%block>


<%block name="extra_js">
<script src="/assets/js/flowr.plugin.js"></script>
<script>
jsonContent = ${photo_array_json};
$("#gallery_container").flowr({
        data : jsonContent,
        height : ${thumbnail_size}*.6,
        padding: 5,
        rows: -1,
        render : function(params) {
            // Just return a div, string or a dom object, anything works fine
            img = $("<img />").attr({
                'src': params.itemData.url_thumb,
                'width' : params.width,
                'height' : params.height
            }).css('max-width', '100%');
            link = $( "<a></a>").attr({
                'href': params.itemData.url,
                'class': 'image-reference'
            });
            div = $("<div />").addClass('image-block').attr({
                'title': params.itemData.title,
                'data-toggle': "tooltip",
            });
            link.append(img);
            div.append(link);
            div.hover(div.tooltip());
            return div;
        },
        itemWidth : function(data) { return data.size.w; },
        itemHeight : function(data) { return data.size.h; },
        complete : function(params) {
            if( jsonContent.length > params.renderedItems ) {
                nextRenderList = jsonContent.slice( params.renderedItems );
            }
        }
    });
$("a.image-reference").colorbox({rel:"gal", maxWidth:"100%",maxHeight:"100%",scalePhotos:true});
</script>
</%block>
